{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>P4 Drawing</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>

    <style type="text/css">
    	.sidebar {
			position: fixed;
			width: 0;
			height: 100%;
			padding: 5px 0 0 10px;
			top: 0;
			left: 0;
			background-color: #fff;
			overflow-x: hidden;
			transition: 0.5s;
			z-index: 2;
		}

		.sidebar a {
			padding: 10px;
			text-decoration: none;
			font-size: 20px;
			color: #000;
			display: block;
			transition: 0.3s;
		}

		#overlay {
			position: fixed;
			display: none;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0,0,0,0.5);
			z-index: 1;
		}

		#menu {
			font-size: 40px !important;
			text-decoration: underline !important;
		}

		.favoritesButton {
			opacity: 100; 
			width: 60px; 
			height: 60px; 
			border-radius: 300px;
			color: #ffd700;

		}

		.navbar
        {
            border-bottom:1px solid #000;
        }
        .dropdown.show {
		    padding: 0;
		    margin: 0;
		}
		
    </style>

    

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<body>
    <!-- You may change the dimensions of this canvas -->
    <nav class="navbar navbar-light bg-white">
		<div class="container-fluid">
			<!-- Left side -->
			<div class="d-inline-block">
				<button class="navbar-toggler" type="button" onclick="openNav()">
					<span class="navbar-toggler-icon"></span>
				</button>
				
			</div>
			<div class="dropdown show">
				  <a class="btn btn-mute dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				    Collaboration mode
				  </a>

				  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
				    <a class="dropdown-item" href="#">Edit</a>
				    <a class="dropdown-item" href="#">Comment</a>
				    <a class="dropdown-item" href="#">View</a>
				  </div>
				</div>
				<!-- Collapsible -->
				<div id="sidebar" class="sidebar">
					<div class="d-flex align-items-center">
						<div id="menu" class="flex-fill">Menu</div>
						<div><a href="javascript:void(0)" class="mt-3" onclick="closeNav()"><i class="fas fa-angle-left"></i></a></div>
					</div>
					<a href="#">Share</a>
					<a href="#">Copy link</a>
					<a href="#">Rename</a>
					<a href="#">Settings</a>
					<a href="#">Delete</a>
				</div>
			<!-- Right side -->
			<div class="">
				<button class="favoritesButton btn-danger" >
					
				</button>
				<button class="favoritesButton btn-info" >
			
				</button>
				<button class="favoritesButton btn-warning">
				
				</button>
			</div>
		</div>
	</nav>

	<div class="container mx-1 px-0">
		<div class="col-1">
			<div class="row" style="height: 50vh">
			1
			</div>
			<div class="row" style="height: 50vh">
			2
			</div>
			<div class="row" style="height: 50vh">
			3
			</div>
			<div class="row" style="height: 50vh">
			4
			</div>
			<div class="row" style="height: 50vh">
			5
			</div>
			<div class="row" style="height: 50vh">
			6
			</div>
			<div class="row" style="height: 50vh">
			7
			</div>
			<div class="row" style="height: 50vh">
			8
			</div>
			<div class="row" style="height: 50vh">
			9
			</div>
			<div class="row" style="height: 50vh">
			10
			</div>
			<div class="row" style="height: 50vh">
			11
			</div>

		</div>
	</div>

	<!--overlay-->
		<div id="overlay"></div>
	<!-- bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	<!-- font awesome -->
    <script src="https://kit.fontawesome.com/5476543f0a.js" crossorigin="anonymous"></script>
	<script>
		function openNav() {
			document.getElementById("overlay").style.display = "block";
			document.getElementById("sidebar").style.width = "250px";
			document.getElementById("main").style.marginLeft = "250px";
		}

		function closeNav() {
			document.getElementById("overlay").style.display = "none";
			document.getElementById("sidebar").style.width = "0";
			document.getElementById("main").style.marginLeft = "0";
		}
	</script>
</body>
<script>

    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    // setting up the canvas and one paper tool
    var canvas = document.getElementById('myCanvas');
    paper.setup(canvas);
    var tool = new paper.Tool();
    var uid = Date.now() % 10000;
    var color = getRandomColor();

    var pathsDict = {};
    pathsDict[uid] = new paper.Path();

    // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
    var isSmall = (url.split("size=")[1]) !== "large";
    console.log(isSmall);

    var socket = new WebSocket(
        'ws://' + window.location.host + '/ws/draw');

    tool.onMouseMove = function(event) { //http://paperjs.org/reference/tool/ path examples
        if(isSmall) {
            pathsDict[uid].strokeColor = color;
            pathsDict[uid].add(event.point);
            // You may need to add code here if you want to pass any other information.
            socket.send("{\"x\" : " + event.point.x + ", \"y\" : " + event.point.y + ", \"uid\" : " + uid + ", \"color\" : " + "\"" + color + "\"" + "}");
        }
    }

    socket.onmessage = function(receivedMessage) {
        var received = JSON.parse(receivedMessage.data);
        console.log("Received: " + JSON.stringify(received));
        // You will probably want to add some code here to draw more lines.
        if(!(received.uid in pathsDict)) {
            pathsDict[received.uid] = new paper.Path();
            pathsDict[received.uid].strokeColor = received.color;
        }
        
        if(received.uid !== uid && !isSmall) {
            var newPoint = new paper.Point(received.x, received.y);
            pathsDict[received.uid].add(newPoint);
        }
    }

    socket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

</script>
</html>
